<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - SERENE AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body { 
            margin: 0;
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            width: 100vw;
            overflow: hidden;
            background: #000;
            position: relative;
        }

        /* ðŸ”¥ Optimized 60s Slow Motion Background */
        .bg-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Darker overlay to hide purple spots/artifacts */
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.5)), 
                        url("/static/gif/wallpaper2.jpg");
            background-size: 150% 150%;
            background-position: center;
            z-index: -1;
            animation: moveBackground 10s ease-in-out infinite;
        }

        @keyframes moveBackground {
            0% { background-position: 0% 50%; background-size: 150% 150%; }
            50% { background-position: 100% 50%; background-size: 120% 120%; }
            100% { background-position: 0% 50%; background-size: 150% 150%; }
        }

        /* Glass Card Container */
        .card { 
            background: rgba(255, 255, 255, 0.08); 
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            padding: 45px; 
            border-radius: 30px; 
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 50px rgba(0,0,0,0.6); 
            width: 380px; 
            text-align: center; 
            color: white;
            z-index: 10;
        }

        h2 { margin-bottom: 30px; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; font-size: 24px; }

        /* Input Styling with Validation Colors */
        input { 
            width: 100%; 
            padding: 14px 18px; 
            margin: 10px 0; 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            border-radius: 12px; 
            background: rgba(255, 255, 255, 0.05);
            color: white;
            outline: none;
            transition: 0.4s ease;
        }

        input:focus { 
            background: rgba(255, 255, 255, 0.15);
            border-color: #2ecc71;
        }

        /* Visual feedback for valid/invalid inputs */
        input:valid:not(:placeholder-shown) {
            border-color: #2ecc71;
        }

        input:invalid:not(:placeholder-shown) {
            border-color: #ff7675;
        }

        button { 
            width: 100%; 
            padding: 15px; 
            background: #2ecc71; 
            color: white; 
            border: none; 
            border-radius: 12px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 600;
            margin-top: 20px;
            transition: 0.3s ease;
            box-shadow: 0 10px 20px rgba(46, 204, 113, 0.2);
        }

        button:hover { 
            background: #27ae60; 
            transform: translateY(-2px);
            box-shadow: 0 15px 25px rgba(46, 204, 113, 0.4);
        }

        p { margin-top: 25px; font-size: 14px; opacity: 0.8; }
        a { color: #2ecc71; text-decoration: none; font-weight: bold; }
        a:hover { text-decoration: underline; }

        #msg { margin-top: 15px; font-weight: 500; min-height: 20px; }

    </style>
</head>
<body>
    <div class="bg-layer"></div>

    <div class="card">
        <h2>Register Here âœ¨</h2>
        
        <input type="email" id="user" placeholder="Enter Email" required autocomplete="off">
        
        <input type="password" id="pass" placeholder="Password (Min 8 chars)" required minlength="8">
        
        <button onclick="register()">Sign Up</button>
        
        <p>Already have an account? <a href="/login">Login</a></p>
        <p id="msg"></p>
    </div>

    <script>
        async function register() {
            let uInput = document.getElementById('user');
            let pInput = document.getElementById('pass');
            let msg = document.getElementById('msg');

            let u = uInput.value.trim();
            let p = pInput.value.trim();

            // 1. JS Validation Check
            if(!uInput.checkValidity()) {
                msg.style.color = "#ff7675";
                msg.innerText = "Please enter a valid email address.";
                return;
            }

            if(p.length < 8) {
                msg.style.color = "#ff7675";
                msg.innerText = "Password must be at least 8 characters.";
                return;
            }

            msg.style.color = "white";
            msg.innerText = "Creating Account...";

            try {
                let res = await fetch('/register_api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: u, password: p })
                });

                let data = await res.json();
                if (data.success) {
                    msg.style.color = "#2ecc71";
                    msg.innerText = "Welcome! Redirecting...";
                    setTimeout(() => window.location.href = "/chat", 1000);
                } else {
                    msg.style.color = "#ff7675";
                    msg.innerText = data.message || "Registration failed";
                }
            } catch (err) {
                msg.style.color = "#ff7675";
                msg.innerText = "Server error. Try again.";
            }
        }
    </script>
</body>
</html>